if("object"==typeof exports&&"string"!=typeof exports.nodeName&&"function"!=typeof define)var define=function(a){a(require,exports,module)};define("template",["require","exports","module","dtools"],function(a,b,c){var d=a("dtools");OPEN_TAG="<?",CLOSE_TAG="?>";var e=function(a){this.vars={},this.fns={},this.helpers={};var b="var ___tpContent = '',\t\tprint = function(){\t\t\t___tpContent += [].join.call(arguments, '');\t\t};\t\t___tpContent += '"+this.compile(a)+"';\t\treturn ___tpContent;";this.fn=new Function(b),e.debug&&console.log(b)};e.prototype={render:function(a,b){a=d.mix(a,this.helpers),this.checkVarsAndFns(a);var c=this.fn.call(a);if(b&&void 0==typeof document){var e=document.createElement("div");e.innerHTML=c;for(var f=document.createDocumentFragment(),g=e.children;g.length>0;)f.appendChild(g[0]);return f}return c},checkVarsAndFns:function(a){for(var b in this.vars)void 0===a[b]&&(e.debug&&console.warn('Variable "'+b+'" does not exists'),a[b]="");for(var b in this.fns)void 0===a[b]&&(e.debug&&console.warn('Function "'+b+'" does not exists'),a[b]=this.emptyFn)},emptyFn:function(){return""},parseVars:function(a){for(var b=null,c=/this\.([\w\$]+)\(*/g;null!=(b=c.exec(arguments[0]));)"("==b[0].substr(-1,1)?this.fns[b[1]]=1:this.vars[b[1]]=1},compile:function(a){var b=this;a=a.replace(/('|"|\\)/g,"\\$1").replace(/\r/g,"").replace(/\t/g,"\\t").replace(/\n/g,"\\n");var c=new RegExp("\t=(.*?)"+CLOSE_TAG.replace(/\?/g,"\\?"),"g"),d=new RegExp("\t(.*?)"+CLOSE_TAG.replace(/\?/g,"\\?"),"g");return a=a.split(OPEN_TAG).join("\t").replace(c,function(){b.parseVars(arguments[0]);var a=arguments[1].replace(/\\t/g," ").replace(/\\n/g,"\n").replace(/\\r/,"\r").replace(/\\('|"|\\)/g,"$1");return"' + ("+a+");\r\n___tpContent += '"}).replace(d,function(){b.parseVars(arguments[0]);var a=arguments[1].replace(/\\t/g," ").replace(/\\n/g,"\n").replace(/\\r/,"\r").replace(/\\('|"|\\)/g,"$1");return"';\r\n"+a+"\r\n___tpContent += '"})},setHelpers:function(a){this.helpers=d.mix(this.helpers,a)},setHelper:function(a,b){this.helpers[a]=b}},e.debug=!1,c.exports=e});